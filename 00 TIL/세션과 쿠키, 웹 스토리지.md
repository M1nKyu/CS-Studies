---
created: 2025-01-18 17:15
category:
  - network
tags:
  - TIL
last_modified: 2025-01-21T17:35:00
---
## ⭐ 세션과 쿠키, 웹 스토리지
> - HTTP 개념 -> [[HTTP와 HTTPS]]

### 🍪 HTTP 프로토콜의 특징
#### 🍬 비연결지향 (Connectionless)
- HTTP 프로토콜은 클라이언트에서 서버에 요청(Request)를 보내면 서버는 클라이언트에 응답(Response)을 하고 TCP/IP 연결을 끊는 특징을 가진다.
- 장점: 서버의 부하를 줄여 더 많은 클라이언트의 요청을 처리할 수 있다.
- 단점: 요청을 받을 때마다 클라이언트와의 커넥션을 새로 만들어주어야 한다.
#### 🍬 무상태 (Stateless)
- HTTP 통신은 연결을 끊는 순간 클라이언트와 서버의 통신이 끝나며, 상태 정보를 유지하지 않는다. (Stateless 하다.)
- 서버는 클라이언트의 상태를 보존하지 않는다.
- ![Stateful과 Statless](https://images.velog.io/images/bumsu0211/post/0c19864c-d167-436f-b7ab-a0edeaaad43a/Untitled%201.png)
- 이전 요청을 기록하기 위한 저장 공간이 필요없다.

> Stateless 특징에 의해 
> - 클라이언트와 첫 번째 통신에서 데이터를 주고 받아도, 두 번째 통신에서 이전 데이터를 유지하지 않는다. 
> - 하지만, 실제로는 **데이터 유지가 필요한 경우가 많다**.
> - ex: 
> 	- 사용자가 로그인을 유지한 상태로 사이트를 탐색할 수 있어야 함.
> 	- 장바구니에 상품을 담고 결제까지 진행할 수 있어야 함.

#### 🍬 쿠키와 세션의 등장 배경
- 위의 HTTP 프로토콜의 특징이자 약점을 보완하기위해 등장했다.
	- 무상태(Stateless) 보완 -> 사용자의 상태 유지
---
### 🍪 쿠키 (Cookie)
#### 🍬 개념
- 클라이언트(사용자의 브라우저)에 저장되는 작은 데이터 파일.
- 서버가 클라이언트에게 특정 데이터를 저장하도록 명령하며, 
	- 이후 요청 시 클라이언트가 HTTP 헤더에 이 데이터를 담아 서버로 다시 전달한다.
#### 🍬 특징
- **클라이언트(브라우저) 측에 저장**된다. 
- **제한된 크기**: 쿠키는 4KB 정도로 제한되며, 하나의 도메인 당 20~50개까지 저장할 수 있다.
- 수명: **만료 기간**(Expiration time)을 설정할 수 있다. 기간에 따라 `세션 쿠키`, `영구 쿠키`로 나뉜다.
	- 세션 쿠키: 브라우저를 닫으면 삭제된다.
	- 영구 쿠기: 만료 기간을 설정 -> 브라우저를 닫아도 유지된다.
- 보안: 클라이언트 측에 저장되므로 **보안에 취약**하다. 중요한 데이터는 암호화하거나 저장하면 안된다.
- **Key-Value 구조**: Key-Value 형태로 문자열 타입으로 저장된다.

#### 🍬 동작 원리
1. 서버의 응답: 서버는 HTTP 응답 헤더에 `Set-Cookie`를 포함시켜 클라이언트에 쿠키를 저장하도록 요청한다.
2. 클라이언트의 저장: 서버가 지정한 쿠키를 저장한다.
3. 요청 시 쿠키 전송: 이후 클라이언트가 동일한 서버에 요청을 보낼 때, 저장된 쿠키를 자동으로 포함한다.

#### 🍬 종류
- **세션 쿠키(Session Cookie)**
	- 브라우저를 닫으면 삭제된다.
	- 만료 시간(Expires)이 설정되지 않은 쿠키.
- **영속 쿠키(Persistent Cookie)**
	- 특정 만료 시간이 설정된 쿠키.
	- 브라우저를 닫아도 만료시간까지 유지된다.
- **보안 쿠키(Secure Cookie)**
	- HTTPS 프로토콜에서만 사용, 쿠키 정보가 암호화되어 전송된다.
- **서드파티 쿠키(Third-Pary Cookie)**
	- 사용자가 방문한 도메인이 아닌 다른 도메인에서 생성된 쿠키.
	- 주로 광고 추적 및 분석에 사용된다.

#### 🍬 장단점
- 장점
	- *사용자 경험 개선*: 로그인 상태 유지, 사용자 설정 저장 가능.
	- *간편한 구현*: 서버와 클라이언트 간 데이터 교환이 간단.
	- *경량 데이터 관리*: 가벼운 데이터를 클라이언트에서 처리 -> 서버 부담 감소.

- 단점
	- *보안 문제*: 쿠키가 평문으로 전송 -> 정보 탈취 위험성.
	- *크기 제한*: 대량 데이터 처리에 적합하지 않음.
	- *사용자 제어*: 사용자가 쿠키를 차단하거나 삭제 가능.
	- *추적 문제*: 제3자 쿠키는 사용자 개인정보 보호 측면에서 논란이 많음.

#### 🍬 쿠키의 사용 목적
1. **세션 관리** (Session Management)
	- 로그인, 사용자 정보, 접속 시간, 장바구니 등의 정보 저장.
	- 사용자가 로그인 후 다른 페이지로 이동해도 인증 정보를 유지
2. **개인화** (Personalization)
	- 사용자마다 적절한 페이지를 보여줄 수 있다.
	- ex(사용자 설정 저장): 테마, 언어설정, 글자크기 등 개인화된 설정 정보 보장
	- ex(광고 추적): 사용자의 브라우징 행동을 추적 -> 맞춤 광고 제공
3. **트래킹** (Tracking)
	- 사용자의 행동과 패턴을 분석하고 기록한다.
	- ex(웹사이트 분석): 방문자 수, 페이지뷰, 재방문율 등 추적.
---
### 🍪 세션 (Session)
#### 🍬 개념
- 서버 측에서 관리되는 사용자 상태 정보이다.
- 클라이언트와 서버 간의 고유한 연결 상태를 유지하기 위해 **세션ID** 라는 고유한 값을 사용한다.
- 보안적으로 중요한 정보들을 서버 안에서 다루기 위해 사용한다.

#### 🍬 동작 원리
1. **클라이언트 요청**: 클라이언트가 서버에 요청.
2. **세션 생성**: 서버는 클라이언트의 요청을 처리하면서 새로운 세션을 생성, 고유한 세션 ID 부여하여 세션 스토리지에 저장한다. 
3. **세션 ID 전달**: 세션 ID는 클라이언트 측에 쿠키 형태로 저장된다.
	- ex: `Set-Cookie: JSESSIONID=12345; Path=/; HttpOnly; Secure`
	- 세션 ID는 요청마다 서버로 전달되어 사용자를 식별한다.
4. **서버측 상태 관리**: 서버는 세션 ID를 기반으로 클라이언트의 상태나 데이터를 저장 및 관리.
5. **세션 종료**: 로그아웃, 세션 타임아웃이 발생하면 세션 종료.

#### 🍬 구성 요소
- 세션 ID
	- 각 세션을 고유하게 식별하는 값
	- 클라이언트는 세션 ID를 요청마다 서버로 전송하여 상태 유지.
- 세션 데이터
	- 서버가 클라이언트와 관련된 정보를 저장하는 공간.
	- 로그인 정보, 장바구니 내용, 사용자 환경 설정 등.
- 세션 저장소 
	- 세션 데이터가 저장되는 위치 (메모리 / 데이터베이스/ 파일시스템)

#### 🍬 세션의 특징
- 저장 위치
	- 세션 데이터는 서버측에 저장된다.
	- 클라이언트에는 세션ID만 저장, 데이터는 서버에서 관리.

- 수명
	- 기본적으로 클라이언트가 브라우저를 닫으면 종료된다.
	- 타임아웃 기간으로 수명을 설정할 수도 있다.

- 보안
	- 클라이언트에 민감한 데이터를 저장하지 않아 쿠키보다 안전하다.
	- 세션ID 탈취(`Session Hijacking`) 방지를 위해 HTTPS와 `HttpOnly` 속성을 사용하는 것이 중요하다.

- 크기
	- 세션 데이터의 크기는 서버 자원에 따라 결정된다.
	- 대량 데이터를 처리하기에 적합하지만, 서버에 부하가 될 수 있다.

#### 🍬 장단점
- 장점
	- 보안성: 클라이언트에 민감한 정보를 저장하지 않는다.
	- 확장성: 복잡한 상태 정보(로그인, 장바구니 등)을 효율적으로 관리 가능하다.
	- 편리성: 로그인 후 지속적인 상태를 유지하도록 구현하기 쉽다.
	- 다양한 저장소 지원

- 단점
	- **서버 부담 증가**: 접속이 많아지면 세션 데이터가 서버 자원을 많이 차지. 해결을 위해 **세션 클러스터링**, **Redis** 등 **인메모리 데이터 저장소** 활용.
	- 복잡한 구현: 분산 환경(여러 서버)에서 세션관리하려면 추가 설정 필요.
	- 수명 관리: 타임아웃 설정이 적절하지 않으면 불필요한 세션이 유지되어 자원이 낭비될 수 있다.
#### 🍬 실제 사용
1. 사용자 인증
	- 로그인 후 사용자를 인증하고 권한을 부여하는 데 사용.
2. 장바구니 기능
	- 사용자가 쇼핑 도중 담은 상품을 서버에 저장.
3. 사용자 맞춤형 서비스 제공
	- 사용자별 개인화된 데이터 저장.
---
### 🍪 웹 스토리지 (Session Storage, Local Storage)
#### 🍬 개념
- 웹 스토리지는 HTML5에서 추가된 클라이언트 측에서 데이터를 효율적으로 저장하기 위한 기술이다.
- 쿠키와 비교해 **더 많은 데이터를 더 간편하게 저장**할 수 있으며, 서버와의 불필요한 데이터 전송을 줄여 성능을 개선할 수 있다.
- 쿠키의 적은 용량과 서버 통신시 오버헤드, 세션의 서버 자원 차지로 확장성의 한계 -> 웹 스토리지 도입.
- *HTTP Stateless 보완* + *클라이언트 측 데이터 저장* + *서버와의 불필요한 통신 줄임* + *성능 개선*

#### 🍬 특징
- 일반적으로 5MB 정도의 데이터 저장이 가능하다. (쿠키의 약 1000배)
- Key-Value 형태로 데이터를 저장한다.
- 클라이언트 측 저장: 서버와의 통신 없이 데이터를 저장하고 사용할 수 있다. -> 성능 개선에 유리.

| 종류 ->  | 로컬 스토리지                    | 세션 스토리지       |
| ------ | -------------------------- | ------------- |
| 데이터 영구 | 영구적 <br>(수동으로 삭제하기 전까지 유지) | 탭/세션이 종료되면 삭제 |
| 활용사례   | 자동 로그인                     | 일회성 로그인       |

> 웹 스토리지는 두 가지 형태로 나뉜다. (세션 스토리지, 로컬 스토리지)
#### 🍬 세션 스토리지(Session Storage)
> **일시적 데이터 저장소**.
- 데이터는 브라우저 탭(세션)이 열려있는 동안에만 유지, 브라우저 탭을 닫으면 삭제된다.
- 각 탭마다 고유한 스토리지를 가지며, 서로의 데이터를 공유하지 않는다.
- 도메인 및 윈도우 탭별로 구분되는 독립적인 공간.
	- 사용자가 브라우저의 창을 닫거나 탭을 닫으면 저장된 객체가 사라지기 때문에 잠깐의 정보를 저장하기에 용이하다.
- 주로 회원가입 입력폼, 일회성 로그인에 사용된다.

#### 🍬 로컬 스토리지(Local Storage)
> **영구적 데이터 저장소**.
- 데이터는 브라우저에 영구적으로 저장된다. (닫거나 재부팅해도 유지)
- 동일한 브라우저 내에서 동일한 도메인에 접근할 때 저장된 데이터를 공유한다.
- 쿠키를 이용하지 않는 앱 환경에서 자동 로그인 등에 사용된다.

#### 🍬 사용 예시
- 자동 로그인 -> 로컬 스토리지
- 입력 폼 정보 -> 세션 스토리지
- 비로그인 장바구니 -> 세션 스토리지
- 다시 보지 않음 팝업 창 -> 쿠키
---
### 🍪 웹 스토리지 vs 쿠키

| 특징        | 웹 스토리지                               | 쿠키                          |
| --------- | ------------------------------------ | --------------------------- |
| 저장 용량     | 약 5MB                                | 약 4KB                       |
| 전송 방식     | 서버와 통신하지 않음                          | HTTP 요청마다 서버에 전송            |
| 수명        | 로컬 스토리지: 영구적  <br>세션 스토리지: 탭 종료 시 삭제 | 설정된 만료 시간에 따라 다름            |
| 보안        | 상대적으로 안전 (클라이언트 측 저장)                | HTTPOnly와 Secure 속성으로 보안 강화 |
| 데이터 접근 속도 | 빠름                                   | 비교적 느림                      |

---
### 🍪 쿠키 vs 세션

|       | Cookie                             | Session                 |
| ----- | ---------------------------------- | ----------------------- |
| 저장 위치 | 클라이언트 (브라우저)                       | 서버                      |
| 저장 형식 | Text                               | Object                  |
| 보안    | 비교적 취약                             | 비교적 안전                  |
| 수명    | 쿠키 저장 시 설정  <br>(설정 없으면 브라우저 종료 시) | 브라우저 닫기 또는 타임아웃 발생 시 종료 |
| 리소스   | 클라이언트의 리소스                         | 서버의 리소스                 |
| 용량 제한 | 한 도메인 당 20개, 한 쿠키 당 4KB            | 제한 없음<br>(서버 자원에 따라 다름) |
| 속도    | 클라이언트에서 처리되므로 빠름                   | 서버 처리가 필요하여 비교적 느림      |

---
### 🍪 웹 스토리지 vs 쿠키 vs 세션
> **쿠키와 세션**은 인증 및 상태 관리에 적합하며, **웹 스토리지**는 클라이언트 측 데이터 저장에 적합하다.

| 기술         | **클라이언트 중심**    | **서버 중심**   |
| ---------- | --------------- | ----------- |
| **웹 스토리지** | 클라이언트에서만 데이터 관리 | ❌           |
| **쿠키**     | 클라이언트-서버 공유 데이터 | ⭕           |
| **세션**     | ❌               | 서버에서 데이터 관리 |

---
## 🧙‍♂️ 요약
> HTTP의 Stateless 특성 -> 쿠키, 세션, 웹 스토리지 등이 보완.

- **쿠키**
	- 클라이언트 측 데이터 저장.
	- 서버와의 요청마다 데이터를 자동으로 전송.
	- 로그인 상태 유지, 사용자 설정 저장 등에 사용.
	- 보안과 크기 제한 문제.
	- 만료 시간 설정에 따라 세션쿠키, 영구 쿠키.

- **세션**
	- 서버측에서 관리되는 데이터.
	- 클라이언트-서버 상태 정보 유지를 위해 세션ID 사용.
	- 보안적 장점.
	- 서버 자원에 부담을 줄 수 있음.

- **웹 스토리지**
	- 클라이언트 측에 데이터를 저장하는 방식.
	- 쿠키보다 더 큰 용량의 데이터를 다룰 수 있음.
	- 세션 스토리지: 탭이 닫히면 데이터 삭제. (ex: 일회성 로그인)
	- 로컬 스토리지: 데이터가 영구적으로 저장. (ex: 자동 로그인)
	- 서버와의 통신 X -> 성능상 이점.
---
> **참고사이트**
> - [01-블로그(쿠키와 세션)](https://interconnection.tistory.com/74)
> - [02-블로그](https://shuu.tistory.com/174)
> - [03-블로그](https://velog.io/@bumsu0211/HTTP%EC%9D%98-%ED%8A%B9%EC%84%B1%EA%B3%BC-%EC%BF%A0%ED%82%A4-%EC%84%B8%EC%85%98-%ED%86%A0%ED%81%B0)
> - [04-블로그](https://velog.io/@octo__/%EC%BF%A0%ED%82%A4Cookie-%EC%84%B8%EC%85%98Session)
> - [05-블로그](https://racoonlotty.tistory.com/entry/%EC%BF%A0%ED%82%A4%EC%99%80-%EC%84%B8%EC%85%98-%EA%B7%B8%EB%A6%AC%EA%B3%A0-%EB%A1%9C%EC%BB%AC-%EC%8A%A4%ED%86%A0%EB%A6%AC%EC%A7%80%EC%99%80-%EC%84%B8%EC%85%98-%EC%8A%A4%ED%86%A0%EB%A6%AC%EC%A7%80)
