---
created: 2025-02-09 15:22
category:
  - jpa
  - spring
tags:
  - TIL
last_modified: 2025-02-09T16:40:00
---
## â­ JPA 1ì°¨ ìºì‹œì™€ 2ì°¨ ìºì‹œ
### ðŸª 1ì°¨ ìºì‹œ (Persistence Context Cache)
- [[ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ (JPA)|ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸(Persistence Context)]] ë‚´ë¶€ì— ì¡´ìž¬í•˜ëŠ” ìºì‹œì´ë‹¤.
- íŠ¸ëžœìž­ì…˜ ë²”ìœ„ì—ì„œë§Œ ë™ìž‘í•˜ë©°, íŠ¸ëžœìž­ì…˜ì´ ëë‚˜ë©´ ì‚­ì œëœë‹¤.
- EntityManagerê°€ ìƒì„±ë  ë•Œ í•­ìƒ 1ì°¨ ìºì‹œê°€ ìƒì„±ë˜ë©°, EntityManagerê°€ ì¢…ë£Œë  ë•Œ í•¨ê»˜ ì¢…ë£Œëœë‹¤.
- 1ì°¨ ìºì‹œëŠ” JPAì— ê¸°ë³¸ì ìœ¼ë¡œ í™œì„±í™”ë˜ì–´ ìžˆìœ¼ë©°, ë³„ë„ì˜ ì„¤ì •ì´ í•„ìš”í•˜ì§€ ì•Šë‹¤.
#### ðŸ¬ ë™ìž‘ ë°©ì‹
1. `em.find()`ë˜ëŠ” `em.persist()`ë¥¼ í˜¸ì¶œí•˜ë©´, í•´ë‹¹ ì—”í‹°í‹°ëŠ” 1ì°¨ ìºì‹œì— ì €ìž¥ëœë‹¤.
2. ì—”í‹°í‹°ë¥¼ ì¡°íšŒí•  ë•Œ ë¨¼ì € 1ì°¨ ìºì‹œì—ì„œ ì°¾ëŠ”ë‹¤.
3. 1ì°¨ ìºì‹œì— ì—†ë‹¤ë©´ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì¡°íšŒí•˜ì—¬ 1ì°¨ ìºì‹œì— ì €ìž¥í•œ í›„ ë°˜í™˜í•œë‹¤.
4. ì´í›„ ê°™ì€ ì—”í‹°í‹°ë¥¼ ì¡°íšŒí•  ë•Œ ë°ì´í„°ë² ì´ìŠ¤ ì ‘ê·¼ì—†ì´ 1ì°¨ ìºì‹œì—ì„œ ë°”ë¡œ ë°˜í™˜í•œë‹¤.

#### ðŸ¬ 1ì°¨ ìºì‹œì˜ í•œê³„
- íŠ¸ëžœìž­ì…˜ì´ ì¢…ë£Œë˜ë©´ ìºì‹œë„ ì‚¬ë¼ì§„ë‹¤ -> ë‹¤ë¥¸ íŠ¸ëžœìž­ì…˜ì—ì„œ ìž¬ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤.
- ë¶„ì‚° í™˜ê²½ì´ë‚˜ ì—¬ëŸ¬ íŠ¸ëžœìž­ì…˜ì—ì„œ ê³µìœ ê°€ í•„ìš”í•  ë•Œë„ ê³µìœ í•  ìˆ˜ ì—†ë‹¤.
> ì´ëŸ° ê¸€ë¡œë²Œí•œ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ 2ì°¨ ìºì‹œë¥¼ ì‚¬ìš©í•  ìˆ˜ ìžˆë‹¤.
---
### ðŸª 2ì°¨ ìºì‹œ (Second Level Cache)
- ì• í”Œë¦¬ì¼€ì´ì…˜ ì „ì²´ì—ì„œ ê³µìœ í•˜ëŠ” ìºì‹œì´ë‹¤.
- EntityMagerFactory ë‹¨ìœ„ì—ì„œ ê´€ë¦¬ëœë‹¤.
	- ì—¬ëŸ¬ íŠ¸ëžœìž­ì…˜ê³¼ EntityManager ê°„ì— ë°ì´í„°ë¥¼ ê³µìœ í•  ìˆ˜ ìžˆë‹¤.
- ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì¢…ë£Œë˜ê¸° ì „ê¹Œì§€ ìœ ì§€ë  ìˆ˜ ìžˆë‹¤.
- ê¸°ë³¸ì ìœ¼ë¡œ ë¹„í™œì„±í™”ë˜ì–´ ìžˆìœ¼ë©°, í•„ìš”í•œ ê²½ìš° ì„¤ì •ì„ í†µí•´ í™œì„±í™”í•´ì•¼ í•œë‹¤.
#### ðŸ¬ íŠ¹ì§•
- ë™ì‹œì„±ì„ ê³ ë ¤í•œ ì„¤ê³„ê°€ í•„ìš”í•˜ë‹¤.
- ìºì‹œ ì ìš© ë²”ìœ„ë¥¼ ì„¸ë°€í•˜ê²Œ ì„¤ì •í•  ìˆ˜ ìžˆë‹¤.
- ë°ì´í„° ë³€ê²½ ì‹œ ìºì‹œ ë™ê¸°í™” ì „ëžµì´ í•„ìš”í•˜ë‹¤.
- ìžì£¼ ë³€ê²½ë˜ëŠ” ë°ì´í„°ëŠ” ë¶€ì í•©í•˜ë‹¤.

#### ðŸ¬ ë™ìž‘ ë°©ì‹
1. `em.find()`ë¥¼ í˜¸ì¶œí•˜ë©´, ë¨¼ì € 1ì°¨ ìºì‹œì—ì„œ Entityë¥¼ ì°¾ì•„ë³¸ë‹¤.
2. ì¡´ìž¬í•˜ì§€ ì•Šìœ¼ë©´ 2ì°¨ ìºì‹œì—ì„œ Entityë¥¼ ì°¾ì•„ë³¸ë‹¤.
3. 2ì°¨ìºì‹œì—ì„œ ë°ì´í„°ê°€Â ì¡´ìž¬í•œë‹¤ë©´Â Entity ë³µì‚¬ë³¸ì„ ë°˜í™˜í•©ë‹ˆë‹¤.
4. 2ì°¨ìºì‹œì—ë„ ë°ì´í„°ê°€ ì¡´ìž¬í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´Â DBë¥¼ ì¡°íšŒí•˜ì—¬ 2ì°¨ìºì‹œì— ì €ìž¥í•˜ê³  ë°˜í™˜í•©ë‹ˆë‹¤.

#### ðŸ¬ ë³µì‚¬ë³¸ì„ ë°˜í™˜í•˜ëŠ” ì´ìœ 
- 2ì°¨ ìºì‹œëŠ” ë™ì‹œì„±ì„ ê·¹ëŒ€í™”í•˜ê¸° ìœ„í•´ ìºì‹œí•œ ê°ì²´ë¥¼ ì§ì ‘ ë°˜í™˜í•˜ì§€ ì•Šê³  ë³µì‚¬ë³¸ì„ ë§Œë“¤ì–´ ë°˜í™˜í•œë‹¤.
- ë§Œì•½ ìºì‹œí•œ ê°ì²´ë¥¼ ê·¸ëŒ€ë¡œ ë°˜í™˜í•˜ë©´ ì—¬ëŸ¬ ê³³ì—ì„œ ê°™ì€ ê°ì²´ë¥¼ ë™ì‹œì— ìˆ˜ì •í•˜ëŠ” ë¬¸ì œê°€ ë°œìƒí•œë‹¤.
- ìœ„ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ê°ì²´ì— Lockì„ ê±¸ì–´ë‘ëŠ” ë°©ì‹ë„ ìžˆì§€ë§Œ, ì´ëŠ” ì„±ëŠ¥ ì €í•˜ê°€ ë°œìƒí•  ìˆ˜ ìžˆë‹¤.
	- ë½ íšë“(LOCK ACQUIRE)ê³¼ í•´ì œ(LOCK RELEASE) -> ì“°ë ˆë“œ ê°„ ì¡°ìœ¨ í•„ìš”
	- ê²½í•©(Contention) ì¦ê°€ -> ì—¬ëŸ¬ ì“°ë ˆë“œê°€ ê°™ì€ ìžì›ì„ ì‚¬ìš©í•˜ë ¤ê³  ëŒ€ê¸°í•˜ëŠ” ì‹œê°„ ì¦ê°€
	- ë°ë“œë½(Deadlock) ê°€ëŠ¥ì„± -> ë½ì„ ìž˜ëª» ì‚¬ìš©í•˜ë©´ ì‹œìŠ¤í…œì´ ë©ˆì¶œ ìˆ˜ ìžˆìŒ
	- í™•ìž¥ì„± ì €í•˜ -> ë™ì‹œì— ë§Žì€ ìš”ì²­ì´ ë“¤ì–´ì˜¤ë©´ ì„±ëŠ¥ ì €í•˜
- ë½ì„ ì‚¬ìš©í•˜ë©´ ë™ì‹œì„±ì€ ë‚®ì•„ì§€ê³ (ë™ì‹œì²˜ë¦¬ê°€ ì–´ë ¤ì›Œì§), ì„±ëŠ¥ì´ ì €í•˜ë  ìˆ˜ ìžˆë‹¤.
	- ì´ì— ë¹„í•´, ê°ì²´ë¥¼ ë³µì‚¬í•˜ëŠ” ë¹„ìš©ì€ ì €ë ´í•˜ë‹¤.

> `ë™ì‹œì„±`: ì—¬ëŸ¬ ê°œì˜ ìž‘ì—…(ì“°ë ˆë“œ, ìš”ì²­ ë“±)ì´ ê°™ì€ ë¦¬ì†ŒìŠ¤(ë°ì´í„°, ë©”ëª¨ë¦¬, DB ë“±)ì— ë™ì‹œì— ì ‘ê·¼í•  ìˆ˜ ìžˆëŠ” ìƒíƒœ
> `ë™ì‹œì„±ì„ ê·¹ëŒ€í™” í•œë‹¤`: ì—¬ëŸ¬ ìž‘ì—…ì´ ê°™ì€ ìžì›ì— ë™ì‹œì— ì ‘ê·¼í•  ìˆ˜ ìžˆë„ë¡ í•˜ë©´ì„œë„, ë°ì´í„° ì •í•©ì„±ê³¼ ì„±ëŠ¥ì„ ìµœì í™”í•˜ëŠ” ê²ƒ

#### ðŸ¬ êµ¬í˜„ì²´
> 2ì°¨ ìºì‹œëŠ” JPA ìžì²´ì—ëŠ” ì—†ê³  êµ¬í˜„ì²´ì—ì„œ ì œê³µí•œë‹¤.
- EhCache: ê°€ìž¥ ë§Žì´ ì‚¬ìš©ëœë‹¤.
- Infinispan: í´ëŸ¬ìŠ¤í„°ë§ í™˜ê²½ì— ì í•©í•˜ë‹¤.
- Redis: ë¶„ì‚° ìºì‹œë¡œ í™œìš© ê°€ëŠ¥í•˜ë‹¤.
---
### ðŸª 1ì°¨ ìºì‹œì™€ 2ì°¨ ìºì‹œ ë¹„êµ

| êµ¬ë¶„       | 1ì°¨ ìºì‹œ                           | 2ì°¨ ìºì‹œ                                    |
| -------- | ------------------------------- | ---------------------------------------- |
| ì €ìž¥ ìœ„ì¹˜    | `EntityManager` ë‚´ë¶€ (ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸)   | `EntityManagerFactory` ë‚´ë¶€ (ì• í”Œë¦¬ì¼€ì´ì…˜ ì „ì²´ ê³µìœ ) |
| ë²”ìœ„       | íŠ¸ëžœìž­ì…˜ ë‹¨ìœ„                         | ì• í”Œë¦¬ì¼€ì´ì…˜ ë‹¨ìœ„                                |
| ìƒëª…ì£¼ê¸°     | íŠ¸ëžœìž­ì…˜ ì¢…ë£Œ ì‹œ ì‚­ì œ                    | ì• í”Œë¦¬ì¼€ì´ì…˜ ì¢…ë£Œ ì „ê¹Œì§€ ìœ ì§€ ê°€ëŠ¥                      |
| ê³µìœ  ì—¬ë¶€    | ë¶ˆê°€ëŠ¥ (ê° `EntityManager`ë§ˆë‹¤ ê°œë³„ ê´€ë¦¬) | ê°€ëŠ¥ (ëª¨ë“  `EntityManager`ì—ì„œ ê³µìœ )             |
| ì„¤ì • í•„ìš” ì—¬ë¶€ | ìžë™ ì ìš© (JPA ê¸°ë³¸ ê¸°ëŠ¥)               | ë³„ë„ ì„¤ì • í•„ìš” (`@Cacheable`, Hibernate ì„¤ì • ë“±)  |
| ì„±ëŠ¥í–¥ìƒ ëŒ€ìƒ  | íŠ¸ëžœìž­ì…˜ ë‚´ ë°˜ë³µ ì¡°íšŒ                    | ì• í”Œë¦¬ì¼€ì´ì…˜ ì „ì²´ ë°˜ë³µ ì¡°íšŒ                          |


---
### ðŸª Hibernate 2ì°¨ ìºì‹œë³´ë‹¤ Spring ìºì‹œ ì‚¬ìš©ì„ ê¶Œìž¥í•˜ëŠ” ì´ìœ 
> [ì¶œì²˜](https://www.inflearn.com/community/questions/33629/%EA%B0%95%EC%9D%98%EC%97%90%EB%8A%94-%EC%97%86%EB%8A%94-%EB%82%B4%EC%9A%A9%EC%9D%B4%EC%A7%80%EB%A7%8C-cache-%EA%B4%80%EB%A0%A8%ED%95%B4%EC%84%9C-%EC%A7%88%EB%AC%B8%EC%9D%B4-%EC%9E%88%EC%8A%B5%EB%8B%88%EB%8B%A4)
#### ðŸ¬ 1. ì„¤ì •ì˜ ë³µìž¡ì„±
- Hibernate 2ì°¨ ìºì‹œëŠ” ì„¤ì •ì´ ë³µìž¡í•˜ê³ , ì§€ì›í•˜ëŠ” ìºì‹œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë„ ì œí•œì ì´ë‹¤.
- ë°˜ë©´ Spring ìºì‹œ ê¸°ëŠ¥ì€ ë‹¤ì–‘í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì§€ì›í•˜ë©° ì„¤ì •ì´ ìƒëŒ€ì ìœ¼ë¡œ ê°„ë‹¨í•˜ë‹¤.
#### ðŸ¬ 2. ì„œë¹„ìŠ¤ ê³„ì¸µì—ì„œì˜ í™œìš©ì„±
- ì‹¤ë¬´ì—ì„œëŠ” ì„œë¹„ìŠ¤ ê³„ì¸µì—ì„œ ì™¸ë¶€ API í˜¸ì¶œ, ì—¬ëŸ¬ ì—”í‹°í‹° ì¡°íšŒ, DTO ë³€í™˜ ë“±ì˜ ë³µìž¡í•œ ë¡œì§ì„ ìˆ˜í–‰í•œë‹¤.
- Hibernate 2ì°¨ ìºì‹œëŠ” ì—”í‹°í‹° ì¡°íšŒ(ì¿¼ë¦¬ í¬í•¨)ë§Œ ìºì‹œí•  ìˆ˜ ìžˆì–´ í™œìš© ë²”ìœ„ê°€ ì œí•œëœë‹¤.
- Spring ìºì‹œëŠ” DTO ê²°ê³¼ë¥¼ ìºì‹±í•  ìˆ˜ ìžˆì–´, API ì‘ë‹µ ì„±ëŠ¥ì„ ë”ìš± íš¨ê³¼ì ìœ¼ë¡œ ê°œì„ í•  ìˆ˜ ìžˆë‹¤.
#### ðŸ¬ 3. ìºì‹œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì§€ì›
- Springì€ Redis, Ehcache, Caffeine, Guava Cache ë“± ë‹¤ì–‘í•œ ìºì‹œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì§€ì›í•œë‹¤.
- Hibernate 2ì°¨ ìºì‹œëŠ” ì§€ì›í•˜ëŠ” ìºì‹œ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ìƒëŒ€ì ìœ¼ë¡œ ì ë‹¤.

#### ðŸ¬ ê²°ë¡ ì€
- Hibernate 2ì°¨ ìºì‹œëŠ” ì—”í‹°í‹° ë‹¨ìœ„ì˜ ì¡°íšŒ ìºì‹œì—ë§Œ êµ­í•œë˜ì–´ ì‹¤ë¬´ì—ì„œ í™œìš©ì„±ì´ ë–¨ì–´ì§„ë‹¤.
- Springì˜ ìºì‹œ ê¸°ëŠ¥ì„ í™œìš©í•˜ì—¬ DTO ê²°ê³¼ë¥¼ ìºì‹±í•˜ëŠ” ê²ƒì´ ì‹¤ë¬´ì—ì„œ ë” íš¨ê³¼ì ì´ë‹¤.
- Springì€ ë‹¤ì–‘í•œ ìºì‹œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì§€ì›í•˜ì—¬ ìœ ì§€ë³´ìˆ˜ì„±ê³¼ í™•ìž¥ì„±ì´ ë›°ì–´ë‚˜ë‹¤.
---
## ðŸ§™â€â™‚ï¸ ìš”ì•½
- 1ì°¨ ìºì‹œ
	- ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ë‚´ë¶€ì— ì¡´ìž¬í•˜ëŠ” ìºì‹œì´ë‹¤.
	- JPA ê¸°ë³¸ í™œì„±í™”ì´ë©°, ë³„ë„ì˜ ì„¤ì •ì´ í•„ìš”ì—†ë‹¤.
	- ë™ìž‘: ì¡°íšŒ ì‹œ 1ì°¨ ìºì‹œ -> ì—†ìœ¼ë©´ DB ì¡°íšŒ í›„ 1ì°¨ ìºì‹œì— ì €ìž¥
	- í•œê³„: íŠ¸ëžœìž­ì…˜ ì¢…ë£Œ ì‹œ ìºì‹œ ì‚­ì œ -> ë‹¤ë¥¸ íŠ¸ëžœìž­ì…˜ì—ì„œ ìž¬ì‚¬ìš© ë¶ˆê°€

- 2ì°¨ ìºì‹œ
	- ì• í”Œë¦¬ì¼€ì´ì…˜ ì „ì²´ì—ì„œ ê³µìœ ë˜ëŠ” ìºì‹œì´ë‹¤.
	- ì—¬ëŸ¬ íŠ¸ëžœìž­ì…˜ê³¼ EntityManagerê°„ ë°ì´í„°ë¥¼ ê³µìœ í•  ìˆ˜ ìžˆë‹¤.
	- ê¸°ë³¸ì ìœ¼ë¡œ ë¹„í™œì„±í™”ë˜ì–´ ìžˆì–´ ì„¤ì •ì´ í•„ìš”í•˜ë‹¤.
	- ë™ìž‘: 1ì°¨ ìºì‹œ í™•ì¸ -> ì—†ìœ¼ë©´ 2ì°¨ ìºì‹œ í™•ì¸ -> ì—†ìœ¼ë©´ DB ì¡°íšŒ í›„ 2ì°¨ ìºì‹œì— ì €ìž¥
	- ê°ì²´ì˜ ë³µì‚¬ë³¸ì„ ë°˜í™˜í•œë‹¤ -> ë™ì‹œì„± ê·¹ëŒ€í™”
	- ìžì£¼ ë³€ê²½ë˜ëŠ” ë°ì´í„°ì— ë¶€ì í•©í•˜ë‹¤.

- Hibernate 2ì°¨ ìºì‹œë³´ë‹¤ Spring ìºì‹œë¥¼ ê¶Œìž¥í•˜ëŠ” ì´ìœ 
	- Hibernate 2ì°¨ ìºì‹œëŠ” ì—”í‹°í‹° ì¡°íšŒ ìºì‹œë¡œë§Œ í•œì •ë˜ì–´ í™œìš©ì„±ì´ ë‚®ë‹¤.
	- Spring ìºì‹œë¥¼ ì‚¬ìš©í•˜ë©´ DTO ìºì‹±ì´ ê°€ëŠ¥í•˜ì—¬ ì„±ëŠ¥ ìµœì í™”ì— ë” íš¨ê³¼ì ì´ë‹¤.
	- Spring ìºì‹œëŠ” ë‹¤ì–‘í•œ ìºì‹œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì§€ì›í•˜ì—¬ ìœ ì§€ë³´ìˆ˜ì„±ê³¼ í™•ìž¥ì„±ì´ ë›°ì–´ë‚˜ë‹¤.

---
> **ì°¸ê³ ì‚¬ì´íŠ¸**
> - [01](https://devbksheen.tistory.com/entry/JPA-1%EC%B0%A8-%EC%BA%90%EC%8B%9C%EC%99%80-2%EC%B0%A8-%EC%BA%90%EC%8B%9C-%EC%86%8C%EA%B0%9C)
> - [02](https://blog.msg-team.com/jpa-1%EC%B0%A8-%EC%BA%90%EC%8B%9C%EC%99%80-2%EC%B0%A8-%EC%BA%90%EC%8B%9C-657ef1bedc66)
> - [03-í•˜ì´ë²„ë„¤ì´íŠ¸ 2ì°¨ ìºì‹œë³´ë‹¤ ìŠ¤í”„ë§ ì§€ì› ìºì‹œ ê¶Œìž¥ ì´ìœ ](https://www.inflearn.com/community/questions/33629/%EA%B0%95%EC%9D%98%EC%97%90%EB%8A%94-%EC%97%86%EB%8A%94-%EB%82%B4%EC%9A%A9%EC%9D%B4%EC%A7%80%EB%A7%8C-cache-%EA%B4%80%EB%A0%A8%ED%95%B4%EC%84%9C-%EC%A7%88%EB%AC%B8%EC%9D%B4-%EC%9E%88%EC%8A%B5%EB%8B%88%EB%8B%A4)
> - [04](https://vlogue.inblog.ai/36939)
