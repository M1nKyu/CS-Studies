---
created: 2025-02-07 17:19
category:
  - java
tags:
  - TIL
last_modified: 2025-02-08T17:00:00
---
## ⭐ Mutable과 Immutable
### 🍪 Mutable(가변 객체)
- **객체가 생성된 후**에도 그 **상태를 변경**할 수 있는 객체.
- **객체의 내부 상태를 수정**할 수 있기 때문에, 동일한 객체 참조를 공유하는 모든 부분에서 변경 사항이 반영된다.
- 수정이 필요할 경우 Mutable 객체는 **기존 객체에 수정 사항을 곧바로 반영**한다.
- 가변 객체는 멀티스레드 환경에서 사용하기 위해 **별도의 동기화 처리가 필요**하다.
- ex: `ArrayList`, `StringBuilder`, `HashMap` 등
```java
import java.util.ArrayList;

public class MutableExample {
    public static void main(String[] args) {
        ArrayList<String> list = new ArrayList<>();
        list.add("Hello");
        list.add("World");
        
        // 객체 상태 변경
        list.set(0, "Hi");
        
        System.out.println(list); // 출력: [Hi, World]
    }
}
```
---
### 🍪 Immutable (불변 객체)
- **객체가 생성된 후**에는 그 **상태를 변경할 수 없는** 객체.
- 객체의 내부 상태를 수정할 수 없기 때문에, 동일한 객체 참조를 공유하더라도 상태가 변하지 않는다. **새로운 객체를 생성해야 한다**.
- 기존 객체는 그대로 두고 **수정사항을 반영한 새로운 객체를 생성**한다.
- 실제 객체의 값이 변경되지 않으며, 새로운 객체를 생성하고 이 객체에 대한 참조값을 변경한다.
	- **기존 객체는 Garbage**로 남아있다가 **GC에 의해 사라진다**.
- 불변 객체는 **Read-only 메소드만을 제공**하여, 멀티 스레드 환경에서도 안전하게 사용할 수 있다. (신뢰성 보장)
- **Setter 메소드를 제공하지 않으며**, 내부 상태를 제공하는 메소드는 제공하지 않거나 [[방어적 복사(Defensive Copy)]]를 통해 제공된다.
- ex: `Stirng`, `LocalDate`, `Wrapper 타입 (Integer, Float, Boolean...)` 등
```java
public class ImmutableExample {
    public static void main(String[] args) {
        String str = "Hello";
        
        // 새로운 객체 생성
        String newStr = str.concat(" World");
        
        System.out.println(str);    // 출력: Hello
        System.out.println(newStr); // 출력: Hello World
    }
}
```
---
### 🍪 불변 객체 생성 방법
#### 🍬 final 키워드
> 자바에서 **변수들은 기본적으로 가변적**이다. **final 키워드**를 붙이면 참조값을 변경할 수 없도록하여 **불변성을 확보**할 수 있다.
- final 예약어는 
	- `변수`에 사용시 값을 수정할 수 없는 상수로 만들어주고, 
	- `메소드`에 사용시 Overriding을 할 수 없고, 
	- `클래스`에 사용시 상속이 불가능 하다.
#### 🍬 불변 객체를 만드는 기본 원칙
1. 클래스를 `final`로 선언하여 상속을 막는다.
	- 하위 클래스에서 멤버 변수를 변경하는 것을 방지한다.
2. 모든 필드를 `private final`로 선언한다.
	- 외부에서 직접 변경할 수 없도록 한다.
3. Setter 메서드를 제공하지 않는다.
	- 객체 생성 이후 상태 변경을 방지한다.
4. 생성자에서 모든 필드를 초기화한다.
	- 생성 이후 값을 변경할 방법이 없도록 한다.
5. 가변 객체를 사용해야 한다면, 복사본을 만들어 사용한다.
	- 원본 객체의 변경 위험을 방지한다.
---
### 🍪 불변 객체의 사용 이유
#### 🍬 동기화 없이도 안전한(Thread-Safe)한 멀티스레드 프로그래밍.
- 멀티스레드 환경에서는 **공유 자원에 대한 동시 접근으로 인해 동기화 문제**가 발생할 수 있다.
- 공유 자원이 **불변이라면** 항상 동일한 값을 반환하기 때문에 동기화를 **고려하지 않아도 된다**. 

#### 🍬 실패 원자적인(Failure Atomic) 메소드를 만들 수 있다.
- 가변객체는 작업 도중 예외가 발생하면 객체가 불안정한 상태에 빠질 수 있어 추가적인 오류가 유발할 수 있다.
- 어떠한 예외가 발생해도 **메소드 호출 전의 상태를 유지**하여 안정적인 예외처리가 가능하다. 

#### 🍬 캐시, Map, Set 등의 요소로 적합하다.
- 불변 객체는 **해시값이 변경되지 않으므로**, 한 번 저장 후 추가적인 연산 없이 효율적으로 사용할 수 있다.
- **캐싱 및 자료구조에**서 **안정적인 성능**을 제공한다.

#### 🍬 Side Effect 방지 및 오류 가능성 최소화
- `Side Effect`는 객체의 **내부 상태가 변경되면서 예측하지 못한 동작을 유발하는 문제**를 의미한다.
- 불변 객체를 사용하면 상태 변경이 불가능하므로 `Side Effect`가 없는 **순수 함수(Pure Function)** 을 쉽게 작성할 수 있다.
>`순수함수`: 어떤 함수에 동일한 인자를 주었을 때 항상 같은 값을 리턴하는 함수 / 외부의 상태를 변경하지 않는 함수.

#### 🍬 협업 시 예측 가능하고 안전한 코드 제공
- 다른 사람이 작성한 코드가 내부 상태를 변경할 가능성을 제거한다.
- 안전하게 함수를 호출하고 재사용할 수 있다.

#### 🍬 가비지 컬렉션(GC) 성능 향상
- 불변 객체는 한 번 생성되면 변경되지 않아, GC의 최적화에 도움을 줄 수 있다.
- 불변 객체를 포함하는 컨테이너 객체(ex: `ImmutableHolder`)가 존재할 경우, GC는 컨테이너 객체가 살아있는 한 내부 불변 객체를 불필요하게 검사하지 않아도 된다.

---
## 🧙‍♂️ 요약
- Mutable (가변 객체)
	- 객체 생성 후 상태 변경이 가능하다.
	- 멀티스레드 환경에서 동기화가 필요하다.
	- `ArrayList`, `StringBuilder`, `HashMap`

- Immutable (불변 객체)
	- **객체 생성 후 상태 변경이 불가능**하다. 
	- 멀티스레드 환경에서도 안전하다. (**Thread-Safe**)
	- Setter 미제공, 내부 상태를 제공할 경우 [[방어적 복사(Defensive Copy)]]를 사용한다.
	- `String`, `LocalDate`, `Integer` ...
  
- 불변 객체 생성 원칙
	- `final` 클래스 선언 → 상속 방지
	- `private final` 필드 선언 → 외부 변경 방지
	- Setter 미제공 → 상태 변경 방지
	- 생성자에서 필드 초기화 → 변경 불가능 보장
	- 가변 객체는 복사본 사용 → 원본 보호

- 불변 객체의 장점
	- **Thread-Safe**: 동기화 없이 안전한 멀티스레드 프로그래밍  
	- **Failure Atomic**: 예외 발생 시 객체 상태 유지  
	- **효율적인 자료구조 활용**: 캐시, `Map`, `Set` 등에 적합  
	- **부수 효과 방지**: 예측 가능하고 오류 가능성 최소화  
	- **협업에 유리**: 예측 가능한 코드 제공  
	- **GC 성능 향상**: 불필요한 객체 검사 최소화

---
> **참고사이트**
> - [01](https://choiblack.tistory.com/47)
> - [02](https://s-y-130.tistory.com/181)
> - [03](https://velog.io/@developerwan/%EB%B6%88%EB%B3%80-%EA%B0%9D%EC%B2%B4%EC%97%90-%EB%8C%80%ED%95%9C-%EC%83%9D%EA%B0%81-%EC%A0%95%EB%A6%AC)
